<!DOCTYPE html>
<html lang="en-gb">
<head>
    <meta charset="UTF-8">
    <title>OpenTimeline HTML Canvas Frontend Test</title>
</head>
<body>
    <h2>HTML Canvas Test</h2>

    <input
        type="range"
        min="0"
        max="100"
        value="50"
        id="slider"
    />
    <span id="value">50</span>

    <div style="width: 100%; height: 400px; border: 0.5px solid black;">
        <canvas visible style="display: block;"></canvas>
    </div>
    <div style="width: 100%; height: 400px; border: 0.5px solid black;">
        <canvas invisible style="display: block;"></canvas>
    </div>
    
    <!-- <canvas id="canvas"></canvas> -->
    <!-- <open-timeline-canvas></open-timeline-canvas> -->
</body>
</html>

<script type="module">
        import init, * as OpenTimeline from "./../pkg/open_timeline_renderer.js";
        await init();

        // TODO: make sure this is UTF-8 so that glyphs are rendered correctly (eg Eugene Delecriox obviously wrong otherwise)
        console.log(document.characterSet);
        
        let timeline_renderer = new OpenTimeline.OpenTimelineRendererHtmlCanvas();
        timeline_renderer.add_entities(await get_entities());

        // Start animation/draw loop (doesn't seem to speed things up, but does simplify the Rust a tad)
        function animationLoop() {
            timeline_renderer.draw();
            requestAnimationFrame(animationLoop);
        }
        requestAnimationFrame(animationLoop);

        async function get_entities() {
            const entities = await all_entities();
            return entities.filter(entity => entity.start.year > 1600);
        }

        async function all_entities() {
            const res = await fetch('entities.json');
            return await res.json();
        }

        //----------------------------------------------------------------------
        // Slider (TODO: adjust timeline padding)
        //----------------------------------------------------------------------
        document.getElementById('slider').addEventListener('input', event => {
            document.getElementById('value').textContent = event.target.value;
            console.log('Slider value:', event.target.value);
        });
</script>
